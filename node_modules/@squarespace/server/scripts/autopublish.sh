#!/bin/bash

PUBLISHED_VERSION=$(npm view @squarespace/server version)
LOCAL_VERSION=$(node -e "console.log(require('./package.json').version)")

if [ "$PUBLISHED_VERSION" != "$LOCAL_VERSION" ]; then
  echo "Publishing $LOCAL_VERSION. Current published version is $PUBLISHED_VERSION."
  npm publish --unsafe-perm
else
  echo "Skipping publish. Local version ($LOCAL_VERSION) matches the published version ($PUBLISHED_VERSION)."
fi
